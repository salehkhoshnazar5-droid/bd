{% extends "base.html" %}
{% block title %}Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h4 class="mb-0">ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±</h4>
  <div>
    <a href="/admin/logout" class="btn btn-outline-danger btn-sm">Ø®Ø±ÙˆØ¬</a>
  </div>
</div>

<div class="row mb-4">
  <div class="col-md-4">
    <div class="card text-center shadow-sm border-primary">
      <div class="card-body">
        <h6 class="text-muted">ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h6>
        <h2 class="text-primary">{{ total_users }}</h2>
      </div>
    </div>

  </div>
  <div class="col-md-4">
    <div class="card text-center shadow-sm border-success">
      <div class="card-body">
        <h6 class="text-muted">Ú©Ù„ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§</h6>
        <h2 class="text-success">{{ stats.total_logs }}</h2>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card text-center shadow-sm border-info">
      <div class="card-body">
        <h6 class="text-muted">Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ù„Ø§Ø³ Ù‚Ø±Ø¢Ù†</h6>
        <h2 class="text-info">{{ quran_class_requests|length }}</h2>
      </div>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card text-center shadow-sm border-warning">
      <div class="card-body">
        <h6 class="text-muted">Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ù…Ø³ÛŒØ± Ù†ÙˆØ±</h6>
         <h2 class="text-warning">{{ light_path_students_count }}</h2>
      </div>
    </div>
  </div>
</div>

<div class="card mb-4 shadow-sm">
  <div class="card-header bg-warning">Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ù…Ø³ÛŒØ± Ù†ÙˆØ±</div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead>
          <tr>
            <th>Ù†Ø§Ù… Ú©Ø§Ù…Ù„</th>
            <th>Ø´Ù…Ø§Ø±Ù‡ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ</th>
            <th>Ú©Ø¯ Ù…Ù„ÛŒ</th>
            <th>Ù†Ù‚Ø´</th>
            <th>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
          <tr>
            <td>{{ user.profile.first_name if user.profile else '-' }} {{ user.profile.last_name if user.profile else '' }}</td>
            <td>{{ user.student_number }}</td>
            <td>{{ user.profile.national_code if user.profile else '-' }}</td>
            <td><span class="badge bg-secondary">Ú©Ø§Ø±Ø¨Ø±</span></td>
            <td>{{ format_persian_datetime(user.created_at) if user.created_at else '-' }}</td>
            <td><a class="btn btn-sm btn-outline-primary" href="/admin/users/{{ user.id }}">Ø¬Ø²Ø¦ÛŒØ§Øª</a></td>
          </tr>
          {% else %}
          <tr>
            <td colspan="6" class="text-center text-muted">Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="card mb-4 shadow-sm">
  <div class="card-header bg-success text-white">Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ù‚Ø±Ø¢Ù† (Ø¨Ø®Ø´ Ù†ÙˆØ±)</div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead>
          <tr>
            <th>Ù†Ø§Ù…</th>
            <th>Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</th>
            <th>Ø³Ø·Ø­</th>
            <th>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª</th>
            <th>Ù…Ø¯ÛŒØ±ÛŒØª</th>
          </tr>
        </thead>
        <tbody>
          {% for request_item in quran_class_requests %}
          <tr>
            <td>{{ request_item.first_name }}</td>
            <td>{{ request_item.last_name }}</td>
            <td>{{ request_item.level }}</td>
            <td>{{ format_persian_datetime(request_item.created_at) if request_item.created_at else '-' }}</td>
            <td>
              <form method="POST" action="/admin/users/{{ user.id }}/delete" onsubmit="return confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ');">
                   {% csrf_token %}
                  <button class="btn btn-sm btn-outline-danger" type="submit">Ø­Ø°Ù</button>
              </form>
              </form>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="5" class="text-center text-muted">Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}