{% extends "base.html" %}
{% block title %}Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h4 class="mb-0">ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±</h4>
    <a href="/admin/logout" class="btn btn-outline-danger btn-sm">Ø®Ø±ÙˆØ¬</a>
</div>
<div class="row g-3 mb-4">
  <div class="col-md-3"><div class="card text-center shadow-sm border-primary"><div class="card-body"><h6 class="text-muted">ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h6><h2 class="text-primary">{{ users|length }}</h2></div></div></div>
  <div class="col-md-3"><div class="card text-center shadow-sm border-success"><div class="card-body"><h6 class="text-muted">Ú©Ù„ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§</h6><h2 class="text-success">{{ stats.total_logs }}</h2></div></div></div>
  <div class="col-md-3"><div class="card text-center shadow-sm border-info"><div class="card-body"><h6 class="text-muted">Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ Ù†ÙˆØ±</h6><h2 class="text-info">{{ quran_class_requests|length }}</h2></div></div></div>
  <div class="col-md-3"><div class="card text-center shadow-sm border-warning"><div class="card-body"><h6 class="text-muted">Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒØ§Ù† Ù…Ø³ÛŒØ± Ù†ÙˆØ±</h6><h2 class="text-warning">{{ light_path_rows|length }}</h2></div></div></div>
</div>

<div class="card mb-4 shadow-sm">
  <div class="card-header bg-success text-white">A) Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ù‚Ø±Ø¢Ù†</div>
  <div class="card-body">
        <form method="post" action="/admin/quran-classes" class="row g-2 mb-4">
      <div class="col-md-4"><input name="title" class="form-control" placeholder="Ù†Ø§Ù… Ú©Ù„Ø§Ø³" required></div>
      <div class="col-md-3">
        <select name="level" class="form-select" required>
          {% for current_level in range(1, 10) %}
          <option value="{{ current_level }}">Ø³Ø·Ø­ {{ current_level }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3"><input name="description" class="form-control" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª"></div>
      <div class="col-md-2 d-grid"><button class="btn btn-success" type="submit">Ø§ÙØ²ÙˆØ¯Ù† Ú©Ù„Ø§Ø³</button></div>
    </form>

    <h6 class="mb-2">Ù„ÛŒØ³Øª Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ù‚Ø±Ø¢Ù†</h6>
    <div class="table-responsive mb-4">
      <table class="table table-striped align-middle">
        <thead><tr><th>Ø¹Ù†ÙˆØ§Ù†</th><th>Ø³Ø·Ø­</th><th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th><th>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª</th><th>Ù…Ø¯ÛŒØ±ÛŒØª</th></tr></thead>
    <tbody>
          {% for quran_class in quran_classes %}
          <tr>
                        <td>{{ quran_class.title }}</td>
            <td>{{ quran_class.level }}</td>
            <td>{{ quran_class.description or '-' }}</td>
            <td>{{ format_persian_datetime(quran_class.created_at) if quran_class.created_at else '-' }}</td>
            <td>
              <form method="post" action="/admin/quran-classes/{{ quran_class.id }}/edit" class="d-flex flex-column gap-1 mb-2">
                <input name="title" class="form-control form-control-sm" value="{{ quran_class.title }}" required>
                <div class="d-flex gap-1">
                  <select name="level" class="form-select form-select-sm" required>
                    {% for current_level in range(1, 10) %}
                    <option value="{{ current_level }}" {% if current_level == quran_class.level %}selected{% endif %}>{{ current_level }}</option>
                    {% endfor %}
                  </select>
                  <input name="description" class="form-control form-control-sm" value="{{ quran_class.description or '' }}" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª">
                </div>
                <button class="btn btn-sm btn-outline-primary" type="submit">Ø°Ø®ÛŒØ±Ù‡</button>
              </form>
              <form method="post" action="/admin/quran-classes/{{ quran_class.id }}/delete">
                <button class="btn btn-sm btn-outline-danger" type="submit">Ø­Ø°Ù</button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr>
            <tr><td colspan="5" class="text-center text-muted">Ú©Ù„Ø§Ø³ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td></tr>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <h6 class="mb-2">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒØ§Ù† (Ù†Ø§Ù… Ùˆ Ø³Ø·Ø­)</h6>
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead><tr><th>Ù†Ø§Ù…</th><th>Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</th><th>Ø³Ø·Ø­</th><th>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª</th><th>Ù…Ø¯ÛŒØ±ÛŒØª</th></tr></thead>
        <tbody>
          {% for request_item in quran_class_requests %}
          <tr>
            <td>{{ request_item.first_name }}</td>
            <td>{{ request_item.last_name }}</td>
            <td>{{ request_item.level }}</td>
            <td>{{ format_persian_datetime(request_item.created_at) if request_item.created_at else '-' }}</td>
            <td>
              <form method="post" action="/admin/quran-requests/{{ request_item.id }}/delete">
                <button class="btn btn-sm btn-outline-danger" type="submit">Ø­Ø°Ù</button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="5" class="text-center text-muted">Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="card mb-4 shadow-sm">
  <div class="card-header bg-warning">B) Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø§Ù†Ø´ÙˆØ±Ø§Ù† Ù…Ø³ÛŒØ± Ù†ÙˆØ±</div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead><tr><th>Ù†Ø§Ù…</th><th>Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</th><th>Ø³Ø·Ø­</th><th>ÙˆØ¶Ø¹ÛŒØª</th><th>Ø´Ù…Ø§Ø±Ù‡ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ</th><th>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª</th><th>Ù…Ø¯ÛŒØ±ÛŒØª</th></tr></thead>
        <tbody>
          {% for row in light_path_rows %}
          <tr>
            <td>{{ row.record.first_name or '-' }}</td>
            <td>{{ row.record.last_name or '-' }}</td>
            <td>{{ row.level }}</td>
            <td><span class="badge bg-secondary">{{ row.status }}</span></td>
            <td>{{ row.record.student_number or '-' }}</td>
            <td>{{ format_persian_datetime(row.record.created_at) if row.record.created_at else '-' }}</td>
            <td>
              <form method="post" action="/admin/light-path-students/{{ row.record.id }}/edit" class="d-flex flex-column gap-1 mb-2">
                <div class="d-flex gap-1">
                  <input name="first_name" class="form-control form-control-sm" value="{{ row.record.first_name or '' }}" required>
                  <input name="last_name" class="form-control form-control-sm" value="{{ row.record.last_name or '' }}" required>
                </div>
                <input name="student_number" class="form-control form-control-sm" value="{{ row.record.student_number or '' }}" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ">
                <button class="btn btn-sm btn-outline-primary" type="submit">Ø°Ø®ÛŒØ±Ù‡</button>
              </form>
              <form method="post" action="/admin/light-path-students/{{ row.record.id }}/delete">
                <button class="btn btn-sm btn-outline-danger" type="submit">Ø­Ø°Ù</button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr><td colspan="7" class="text-center text-muted">Ø±Ú©ÙˆØ±Ø¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}